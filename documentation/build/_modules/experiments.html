<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>experiments &mdash; AI_Project 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="AI_Project 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">AI_Project 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for experiments</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span>  <span class="n">makedirs</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">join</span> <span class="k">as</span> <span class="n">join_path</span>
<span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">dump</span> <span class="p">,</span> <span class="n">load</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_rel</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span>  <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span> <span class="k">as</span> <span class="n">RFC</span>
<span class="kn">from</span> <span class="nn">sklearn.grid_search</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.learning_curve</span> <span class="kn">import</span> <span class="n">learning_curve</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span> <span class="k">as</span> <span class="n">DTC</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">data.cross_validation</span> <span class="kn">import</span> <span class="n">CrossValidation</span>
<span class="kn">from</span> <span class="nn">utils.argumet_parsers</span> <span class="kn">import</span> <span class="n">ExperimentArgsParser</span>
<span class="kn">from</span> <span class="nn">utils.constants</span> <span class="kn">import</span> <span class="n">LEAGUES</span><span class="p">,</span> <span class="n">MAX_YEAR</span><span class="p">,</span> <span class="n">MIN_YEAR</span>
<span class="kn">from</span> <span class="nn">utils.decorators</span> <span class="kn">import</span> <span class="n">timed</span>


<div class="viewcode-block" id="Experiment"><a class="viewcode-back" href="../expr.html#experiments.Experiment">[docs]</a><span class="k">class</span> <span class="nc">Experiment</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract Experiment class.</span>
<span class="sd">    </span>
<span class="sd">    Experiments classes provide basic functionality to running an experiment-</span>
<span class="sd">            allows saving and loading the results</span>
<span class="sd">            automatically loads data for cross validation</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Experiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.Experiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new Experiment instance.</span>
<span class="sd">        </span>
<span class="sd">        Requires a dir_name (to save results) and a flag to indicate whether it&#39;s test environment or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dir_name</span> <span class="o">=</span> <span class="n">dir_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">=</span> <span class="n">join_path</span><span class="p">(</span><span class="s">&#39;Results&#39;</span><span class="p">,</span><span class="n">dir_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test</span> <span class="o">=</span> <span class="n">test</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="bp">None</span>
        </div>
<div class="viewcode-block" id="Experiment.save"><a class="viewcode-back" href="../expr.html#experiments.Experiment.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves data into the results dir under the special format {experiment_name}.results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">):</span>
            <span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;.results&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_f</span><span class="p">:</span>
            <span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_f</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Experiment.load"><a class="viewcode-back" href="../expr.html#experiments.Experiment.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads results from previous runs into _loaded_data attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_path</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.results&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">_f</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Experiment.get_data"><a class="viewcode-back" href="../expr.html#experiments.Experiment.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all the examples and tags needed for the experiment.</span>
<span class="sd">        </span>
<span class="sd">        Loads the all of the examples and tags, and also creates a cross validation for using in the estimators \ searches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidation</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="n">lookback</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span> <span class="k">else</span> <span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">lookback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_tags</span>
    </div>
    <span class="nd">@timed</span>    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the experiment.</span>
<span class="sd">        </span>
<span class="sd">        You should override this function in derived classes to configure the experiment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        
<div class="viewcode-block" id="Experiment.load_params"><a class="viewcode-back" href="../expr.html#experiments.Experiment.load_params">[docs]</a>    <span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the parameters of the experiment.</span>
<span class="sd">        </span>
<span class="sd">        You should override this in derived classes to configure the experiment parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    </div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @todo:    t_test for 2 algs</span>
<span class="sd">              validate &amp; report</span>
<span class="sd">    &quot;&quot;&quot;</span>
      
<div class="viewcode-block" id="Experiment.t_test"><a class="viewcode-back" href="../expr.html#experiments.Experiment.t_test">[docs]</a>    <span class="k">def</span> <span class="nf">t_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">original_measurements</span><span class="p">,</span> <span class="n">measurements_after_alteration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the paired T-test (for repeated measurements):</span>
<span class="sd">        Given two sets of measurements on the SAME data points (folds) before and after some change,</span>
<span class="sd">        Checks whether or not they come from the same distribution. </span>
<span class="sd">        </span>
<span class="sd">        This T-test assumes the measurements come from normal distributions.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            The probability the measurements come the same distributions</span>
<span class="sd">            A flag that indicates whether the result is statically significant</span>
<span class="sd">            A flag that indicates whether the new measurements are better than the old measurements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SIGNIFICANCE_THRESHOLD</span><span class="o">=</span> <span class="mf">0.05</span>
        
        <span class="n">test_value</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span> <span class="n">ttest_rel</span><span class="p">(</span><span class="n">original_measurements</span><span class="p">,</span> <span class="n">measurements_after_alteration</span><span class="p">)</span>
        <span class="n">is_significant</span><span class="o">=</span> <span class="n">probability</span><span class="o">/</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">SIGNIFICANCE_THRESHOLD</span>
        <span class="n">is_better</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">original_measurements</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">measurements_after_alteration</span><span class="p">)</span> <span class="c">#should actually compare averages, but there&#39;s no need since it&#39;s the same number of measurments.</span>
        <span class="k">return</span> <span class="n">probability</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">is_better</span> <span class="k">else</span> <span class="mi">1</span><span class="o">-</span><span class="n">probability</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">is_significant</span><span class="p">,</span> <span class="n">is_better</span>
    </div>
<div class="viewcode-block" id="Experiment._load_prev_experiment"><a class="viewcode-back" href="../expr.html#experiments.Experiment._load_prev_experiment">[docs]</a>    <span class="k">def</span> <span class="nf">_load_prev_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function to load a previous experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exp</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Failed to load previous {ex} experiment</span><span class="se">\n</span><span class="s">. If you would like to run the {ex} experiment, Please type:</span><span class="se">\n</span><span class="s"> Yes I am sure&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="o">=</span><span class="n">exp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s">&#39;Yes I am sure&#39;</span><span class="p">:</span>
                <span class="n">exp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
  </div>
<div class="viewcode-block" id="Experiment.report"><a class="viewcode-back" href="../expr.html#experiments.Experiment.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbosity</span><span class="p">,</span><span class="n">outfile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A method to report the experiment&#39;s results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;Can not report, must run experiment before!&#39;</span>
                    <span class="k">return</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_begining_report</span>
        <span class="k">if</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_detail</span>
        <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detail</span>
        <span class="k">elif</span> <span class="n">verbosity</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_more_detail</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ending_report</span>
</div></div>
<div class="viewcode-block" id="BestParamsExperiment"><a class="viewcode-back" href="../expr.html#experiments.BestParamsExperiment">[docs]</a><span class="k">class</span> <span class="nc">BestParamsExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment class to search for the best hyperparameters for an estimator.</span>
<span class="sd">    </span>
<span class="sd">    The search is done using RandomGridSearchCV, on the DecisionTreeClassifer estimator and the </span>
<span class="sd">    RandomForestClassifier estimator. </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BestParamsExperiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.BestParamsExperiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Best_Params&#39;</span>
        </div>
<div class="viewcode-block" id="BestParamsExperiment.load_params"><a class="viewcode-back" href="../expr.html#experiments.BestParamsExperiment.load_params">[docs]</a>    <span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the parameters for the experiment - the grids to search on.</span>
<span class="sd">        </span>
<span class="sd">        To change parameters or values for one of the estimators - change to correct field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&#39;DTC&#39;</span><span class="p">:{</span><span class="s">&#39;criterion&#39;</span><span class="p">:[</span><span class="s">&#39;gini&#39;</span><span class="p">,</span><span class="s">&#39;entropy&#39;</span><span class="p">],</span>\
                           <span class="s">&#39;max_depth&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                           <span class="s">&#39;max_leaf_nodes&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                           <span class="s">&#39;min_samples_leaf&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span>\
                           <span class="s">&#39;min_samples_split&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>\
                           <span class="s">&#39;splitter&#39;</span><span class="p">:[</span><span class="s">&#39;random&#39;</span><span class="p">,</span><span class="s">&#39;best&#39;</span><span class="p">],</span>\
                           <span class="s">&#39;max_features&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="s">&#39;log2&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">5</span><span class="p">)},</span>\
                    <span class="s">&#39;RFC&#39;</span><span class="p">:{</span><span class="s">&#39;criterion&#39;</span><span class="p">:[</span><span class="s">&#39;gini&#39;</span><span class="p">,</span><span class="s">&#39;entropy&#39;</span><span class="p">],</span>\
                           <span class="s">&#39;max_depth&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                            <span class="s">&#39;max_leaf_nodes&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                            <span class="s">&#39;min_samples_leaf&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span>\
                            <span class="s">&#39;min_samples_split&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>\
                            <span class="s">&#39;n_estimators&#39;</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">401</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>\
                            <span class="s">&#39;max_features&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="s">&#39;log2&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>\
                           <span class="s">&#39;n_jobs&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&#39;DTC&#39;</span><span class="p">:{</span><span class="s">&#39;criterion&#39;</span><span class="p">:[</span><span class="s">&#39;gini&#39;</span><span class="p">],</span>\
                           <span class="s">&#39;max_features&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="s">&#39;log2&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">25</span><span class="p">)},</span>\
                    <span class="s">&#39;RFC&#39;</span><span class="p">:[{</span><span class="s">&#39;criterion&#39;</span><span class="p">:[</span><span class="s">&#39;gini&#39;</span><span class="p">],</span>\
                           <span class="s">&#39;max_features&#39;</span><span class="p">:[</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="s">&#39;log2&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span>\
                           <span class="s">&#39;n_jobs&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}]}</span>
    
    </div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment performed a Randomized Search for 1000 iterations upon the hyper parameters grid for both the </span><span class="se">\</span>
<span class="s">Decision Tree classifier and the Random Forest classifier.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - only tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_def_exp</span> <span class="o">=</span> <span class="n">DefaultParamsExperiment</span><span class="p">(</span><span class="s">&#39;Default_Params&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">_def_exp</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">tree_cross_scores</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span><span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">forest_cross_scores</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">,</span><span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">def_tree_scores</span> <span class="o">=</span> <span class="n">_def_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Default_Tree&#39;</span><span class="p">]</span>
        <span class="n">def_forest_scores</span> <span class="o">=</span> <span class="n">_def_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Default_Forest&#39;</span><span class="p">]</span>
        
        <span class="k">def</span> <span class="nf">_evaluate</span><span class="p">(</span><span class="n">before</span><span class="p">,</span><span class="n">after</span><span class="p">):</span>
            <span class="n">prob</span> <span class="p">,</span> <span class="n">is_sig</span> <span class="p">,</span> <span class="n">is_better</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_test</span><span class="p">(</span><span class="n">before</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">after</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;Paired T Test result between {before_name} and {after_name}: {proba:.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">before_name</span> <span class="o">=</span> <span class="n">before</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">after_name</span><span class="o">=</span><span class="n">after</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">proba</span><span class="o">=</span><span class="n">prob</span><span class="p">),</span>\
                             <span class="s">&#39;The results {sig} statically significant, while {before_name} is {better} with score {before_score:.4f} than {after_name} with score {after_score:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">before_name</span> <span class="o">=</span> <span class="n">before</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">after_name</span><span class="o">=</span><span class="n">after</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">prob</span><span class="o">=</span><span class="n">prob</span><span class="p">,</span><span class="n">before_score</span><span class="o">=</span><span class="n">before</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                                                                <span class="n">after_score</span><span class="o">=</span><span class="n">after</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">sig</span> <span class="o">=</span> <span class="s">&#39;are&#39;</span> <span class="k">if</span> <span class="n">is_sig</span> <span class="k">else</span> <span class="s">&quot;aren&#39;t&quot;</span><span class="p">,</span>
                                                                <span class="n">better</span><span class="o">=</span> <span class="s">&#39;better&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_better</span> <span class="k">else</span> <span class="s">&#39;worse&#39;</span><span class="p">)])</span>
            
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">trees_t_test</span> <span class="o">=</span> <span class="n">_evaluate</span><span class="p">((</span><span class="n">def_tree_scores</span><span class="p">,</span><span class="s">&#39;Decision Tree before search&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">tree_cross_scores</span><span class="p">,</span><span class="s">&#39;Decision Tree after search&#39;</span><span class="p">))</span>
        <span class="n">forests_t_test</span> <span class="o">=</span> <span class="n">_evaluate</span><span class="p">((</span><span class="n">def_forest_scores</span><span class="p">,</span><span class="s">&#39;Random Forest before search&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">forest_cross_scores</span><span class="p">,</span><span class="s">&#39;Random Forest after search&#39;</span><span class="p">))</span>
        <span class="n">tree_forest_test</span> <span class="o">=</span> <span class="n">_evaluate</span><span class="p">((</span><span class="n">tree_cross_scores</span><span class="p">,</span><span class="s">&#39;Decision Tree after search&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">forest_cross_scores</span><span class="p">,</span><span class="s">&#39;Random Forest after search&#39;</span><span class="p">))</span>
        <span class="n">_res</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;Decision Tree before search accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">def_tree_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>\
                          <span class="s">&#39;Decision Tree after search accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_score_</span><span class="p">),</span>\
                          <span class="n">trees_t_test</span><span class="p">,</span><span class="s">&#39;Best Decision Tree hyper parameters:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">),</span>
        <span class="s">&#39;Random Forest before search accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">def_forest_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>\
        <span class="n">forests_t_test</span><span class="p">,</span><span class="s">&#39;Random Forest after search accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_score_</span><span class="p">),</span>\
        <span class="s">&#39;Best Random Forest hyper parameters:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">),</span><span class="n">tree_forest_test</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">_res</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the Decision Tree classifier after search and after fitting all of the data.</span>
<span class="sd">        </span>
<span class="sd">        Saves in results folder, in pdf format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">export_graphviz</span>
        <span class="kn">from</span> <span class="nn">sklearn.externals.six</span> <span class="kn">import</span> <span class="n">StringIO</span>
        <span class="kn">import</span> <span class="nn">pydot</span>
        <span class="n">_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;avg_AccCrosses_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AccCrosses_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AccLB_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AccLB_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AccThB_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AccThB_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AerialsWon_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_AerialsWon_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_BlockedShots_by_def_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_BlockedShots_by_def_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Clearances_by_def_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Clearances_by_def_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Crosses_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Crosses_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Disp_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Disp_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Dribbles_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Dribbles_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Fouled_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Fouled_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Fouls_by_def_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Fouls_by_def_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Interceptions_by_def_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Interceptions_by_def_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_KeyPasses_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_KeyPasses_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_LB_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_LB_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Offsides_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Offsides_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_PA%_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_PA%_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Passes_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Passes_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_ShotsOT_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_ShotsOT_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Shots_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Shots_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_ThB_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_ThB_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_TotalTackles_by_def_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_TotalTackles_by_def_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Touches_by_all_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Touches_by_all_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_UnsTouches_by_att_pos_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_UnsTouches_by_att_pos_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Goals_by_fix_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Goals_by_fix_by_all_HA_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Goals_by_fix_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Goals_by_fix_by_home_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Possession_rate_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Possession_rate_by_all_HA_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Possession_rate_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Possession_rate_by_home_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Success_rate_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Success_rate_by_all_HA_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Success_rate_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_Success_rate_by_home_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_received_Goals_by_fix_by_all_HA&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_received_Goals_by_fix_by_all_HA_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_received_Goals_by_fix_by_home&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;avg_received_Goals_by_fix_by_home_specific&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;relative_all_pos&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;relative_att_pos&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;relative_def_pos&#39;</span><span class="p">]</span>
        <span class="n">dot_data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">export_graphviz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="n">dot_data</span><span class="p">,</span><span class="n">rounded</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Win (Home)&#39;</span><span class="p">,</span><span class="s">&#39;Draw&#39;</span><span class="p">,</span><span class="s">&#39;Win (Away)&#39;</span><span class="p">],</span>\
                        <span class="n">feature_names</span><span class="o">=</span><span class="n">_names</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">graph_from_dot_data</span><span class="p">(</span><span class="n">dot_data</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">,</span><span class="s">&quot;best_tree.pdf&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;The plotted Decision Tree classifier is saved in {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">join_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">,</span><span class="s">&quot;best_tree.pdf&quot;</span><span class="p">)))</span>

    <span class="nd">@timed</span>    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a RandomizedSearch on both DecisionTree and RandomForest classifiers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">_grids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_params</span><span class="p">()</span>
        <span class="n">grid_tree</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">DTC</span><span class="p">(),</span> <span class="n">_grids</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">],</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">grid_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_examples</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_tags</span><span class="p">)</span>
        <span class="n">grid_forest</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">RFC</span><span class="p">(),</span> <span class="n">_grids</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">],</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">grid_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_examples</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Tree&#39;</span><span class="p">:</span><span class="n">grid_tree</span><span class="p">,</span><span class="s">&#39;Forest&#39;</span><span class="p">:</span><span class="n">grid_forest</span><span class="p">}</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="BayesExperiment"><a class="viewcode-back" href="../expr.html#experiments.BayesExperiment">[docs]</a><span class="k">class</span> <span class="nc">BayesExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test Naive Bayes classifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BayesExperiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.BayesExperiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Bayes&#39;</span>
        </div>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">bayes_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">GaussianNB</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Bayes&#39;</span><span class="p">:</span><span class="n">bayes_score</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment tried a Naive Bayes classifier.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - only results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;Gaussian Naive Bayes accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Bayes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())])</span>
     </div>
<div class="viewcode-block" id="DefaultParamsExperiment"><a class="viewcode-back" href="../expr.html#experiments.DefaultParamsExperiment">[docs]</a><span class="k">class</span> <span class="nc">DefaultParamsExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test Decision Tree and Random Forest classifiers without adjusting their respective hyper parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DefaultParamsExperiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.DefaultParamsExperiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Default_Params&#39;</span>
        </div>
<div class="viewcode-block" id="DefaultParamsExperiment.run"><a class="viewcode-back" href="../expr.html#experiments.DefaultParamsExperiment.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs cross validation against Decision Tree and Random Forest classifiers. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">tree_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">DTC</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">forest_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">RFC</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Default_Tree&#39;</span><span class="p">:</span><span class="n">tree_score</span><span class="p">,</span><span class="s">&#39;Default_Forest&#39;</span><span class="p">:</span><span class="n">forest_score</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        </div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment tried both the Decision Tree and the Random Forest classifiers with default hyper parameters.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - only results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;Decision Tree with default hyper parameters accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Default_Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>\
                          <span class="s">&#39;Random Forest with default hyper parameters accuracy score: {0:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Default_Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())])</span>   
    </div>
<div class="viewcode-block" id="LearningCurveExperiment"><a class="viewcode-back" href="../expr.html#experiments.LearningCurveExperiment">[docs]</a><span class="k">class</span> <span class="nc">LearningCurveExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test the learning curves of the classifiers (Decision Tree, Random Forest, Naive Bayes).</span>
<span class="sd">    </span>
<span class="sd">    The learning curve shows the classifier&#39;s accuracy correlation with the size of the training data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="LearningCurveExperiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.LearningCurveExperiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dir_name</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Learning_Curve&#39;</span>
        </div>
<div class="viewcode-block" id="LearningCurveExperiment.run"><a class="viewcode-back" href="../expr.html#experiments.LearningCurveExperiment.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs learning curve on all classifiers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">best_param_exp</span> <span class="o">=</span> <span class="n">BestParamsExperiment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">best_param_exp</span><span class="p">)</span>
        <span class="n">tree_curve</span> <span class="o">=</span> <span class="n">learning_curve</span><span class="p">(</span><span class="n">DTC</span><span class="p">(</span><span class="o">**</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">forest_curve</span> <span class="o">=</span> <span class="n">learning_curve</span><span class="p">(</span><span class="n">RFC</span><span class="p">(</span><span class="o">**</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bayes_curve</span> <span class="o">=</span> <span class="n">learning_curve</span><span class="p">(</span><span class="n">GaussianNB</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Tree_Curve&#39;</span><span class="p">:</span><span class="n">tree_curve</span><span class="p">,</span><span class="s">&#39;Forest_Curve&#39;</span><span class="p">:</span><span class="n">forest_curve</span><span class="p">,</span><span class="s">&#39;Bayes_Curve&#39;</span><span class="p">:</span><span class="n">bayes_curve</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        </div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment checks the learning curve for all the classifiers. </span><span class="se">\n</span><span class="s"></span>
<span class="s">Will plot the learning curves on screen.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity- plots the learning curves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    
    
            <span class="k">def</span> <span class="nf">plot_learning_curve</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">_type</span><span class="o">=</span><span class="s">&#39;Tree&#39;</span><span class="p">):</span>
          
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Training examples&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Score&quot;</span><span class="p">)</span>
                <span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores</span><span class="p">,</span> <span class="n">test_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_type</span><span class="p">]</span>
                <span class="n">train_scores_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">train_scores_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">test_scores_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">test_scores_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            
                <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores_mean</span> <span class="o">-</span> <span class="n">train_scores_std</span><span class="p">,</span>
                                 <span class="n">train_scores_mean</span> <span class="o">+</span> <span class="n">train_scores_std</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_scores_mean</span> <span class="o">-</span> <span class="n">test_scores_std</span><span class="p">,</span>
                                 <span class="n">test_scores_mean</span> <span class="o">+</span> <span class="n">test_scores_std</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;g&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores_mean</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s">&quot;Training score&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_scores_mean</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;g&quot;</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s">&quot;Cross-validation score&quot;</span><span class="p">)</span>
            
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">plt</span>
                    
            <span class="n">plot_learning_curve</span><span class="p">(</span><span class="s">&quot;Learning Curves (Decision Tree)&quot;</span><span class="p">,</span><span class="n">_type</span><span class="o">=</span><span class="s">&#39;Tree_Curve&#39;</span><span class="p">)</span>
            <span class="n">plot_learning_curve</span><span class="p">(</span><span class="s">&quot;Learning Curves (Random Forest)&quot;</span><span class="p">,</span><span class="n">_type</span><span class="o">=</span><span class="s">&#39;Forest_Curve&#39;</span><span class="p">)</span>
            <span class="n">plot_learning_curve</span><span class="p">(</span><span class="s">&quot;Learning Curves (Naive Bayes)&quot;</span><span class="p">,</span><span class="n">_type</span><span class="o">=</span><span class="s">&#39;Bayes_Curve&#39;</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
        </div>
<div class="viewcode-block" id="BestLookbackExperimet"><a class="viewcode-back" href="../expr.html#experiments.BestLookbackExperimet">[docs]</a><span class="k">class</span> <span class="nc">BestLookbackExperimet</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test what is thebest lookback for creating the examples.</span>
<span class="sd">    </span>
<span class="sd">    The lookback parameter defines how many previous games we are taking in consideration while generating the examples. </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BestLookbackExperimet.__init__"><a class="viewcode-back" href="../expr.html#experiments.BestLookbackExperimet.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Best_Lookback&#39;</span>
               </div>
<div class="viewcode-block" id="BestLookbackExperimet.load_params"><a class="viewcode-back" href="../expr.html#experiments.BestLookbackExperimet.load_params">[docs]</a>    <span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">estimators</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The load_params for this experiment loads the best params for the decision tree and random forest.</span>
<span class="sd">        </span>
<span class="sd">        This params found by the experiment best_param.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_param_exp</span> <span class="o">=</span> <span class="n">BestParamsExperiment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">best_param_exp</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="n">DTC</span><span class="p">(</span><span class="o">**</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">),</span>\
                           <span class="n">RFC</span><span class="p">(</span><span class="o">**</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">True</span>
        </div>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lookback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidation</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">,</span><span class="n">remote</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">lookback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_tags</span>
        
<div class="viewcode-block" id="BestLookbackExperimet.run"><a class="viewcode-back" href="../expr.html#experiments.BestLookbackExperimet.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each fixture in range [1,66] (in jumps of 5), run a cross validation on both Decision Tree and Random Forest.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_params</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">lookback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">lookback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">dtc_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rfc_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">cv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">leagues_cross_validation</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lookback</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtc_score</span><span class="p">,</span><span class="n">rfc_score</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        
</div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment checks both classifier&#39;s accuracy correlation with the lookback parameter </span><span class="se">\</span>
<span class="s">for the creation on the examples.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - only tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_dtc_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_lk</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">}</span>
        <span class="n">_rfc_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_lk</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">}</span>
        <span class="n">_table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">([[</span><span class="s">&#39;Decision Tree&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_dtc_scores</span><span class="o">.</span><span class="n">items</span><span class="p">())],</span>\
                           <span class="p">[</span><span class="s">&#39;Random Forest&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_rfc_scores</span><span class="o">.</span><span class="n">items</span><span class="p">())]],</span>\
                          <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Classifier / Lookback&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_dtc_scores</span><span class="p">),</span><span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;fancy_grid&quot;</span><span class="p">,</span><span class="n">floatfmt</span><span class="o">=</span><span class="s">&quot;.4f&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;Cross validation scores for each classifier by lookback:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="n">_table</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Medium verbosity - show plotted graphs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    
    
            <span class="k">def</span> <span class="nf">plot_lookback_curve</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
          
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ylim</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Number of fixtures to look back&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Score&quot;</span><span class="p">)</span>
                <span class="n">_dtc_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_lk</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">}</span>
                <span class="n">_rfc_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_lk</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">}</span>
                
                <span class="n">train_sizes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_dtc_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">train_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_dtc_scores</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>
                <span class="n">test_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_rfc_scores</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span> 
                
                <span class="n">train_scores_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">train_scores_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">test_scores_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">test_scores_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">test_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            
                <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores_mean</span> <span class="o">-</span> <span class="n">train_scores_std</span><span class="p">,</span>
                                 <span class="n">train_scores_mean</span> <span class="o">+</span> <span class="n">train_scores_std</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_scores_mean</span> <span class="o">-</span> <span class="n">test_scores_std</span><span class="p">,</span>
                                 <span class="n">test_scores_mean</span> <span class="o">+</span> <span class="n">test_scores_std</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;g&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">train_scores_mean</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;r&quot;</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s">&quot;Decision Tree score&quot;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">,</span> <span class="n">test_scores_mean</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;g&quot;</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s">&quot;Random Forest score&quot;</span><span class="p">)</span>
            
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&quot;best&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">plt</span>
        
        <span class="n">plot_lookback_curve</span><span class="p">(</span><span class="s">&#39;Best Look Back&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="BestProbaForDecision"><a class="viewcode-back" href="../expr.html#experiments.BestProbaForDecision">[docs]</a><span class="k">class</span> <span class="nc">BestProbaForDecision</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test what is the best threshold from which we want to make the decision.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BestProbaForDecision.__init__"><a class="viewcode-back" href="../expr.html#experiments.BestProbaForDecision.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Best_Proba&#39;</span>
    </div>
    <span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">best_param_exp</span> <span class="o">=</span> <span class="n">BestParamsExperiment</span><span class="p">(</span><span class="s">&quot;Best_Params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">best_param_exp</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;DTC&#39;</span><span class="p">:</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span><span class="s">&#39;RFC&#39;</span><span class="p">:</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">True</span>
    
<div class="viewcode-block" id="BestProbaForDecision.run"><a class="viewcode-back" href="../expr.html#experiments.BestProbaForDecision.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For each probability p in [0.34,0.59] (in jumps of 0.01), make the decision only if classifier&#39;s probability is greater or equal to p.</span>

<span class="sd">        For each probability we calculate the amount of games that qulified and the score will be calculated by this amount.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_params</span><span class="p">():</span> 
            <span class="k">print</span> <span class="s">&#39;Can not run- must load previous experiment&#39;</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.34</span><span class="p">,</span><span class="mf">0.35</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="n">_i</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span><span class="mi">60</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">}</span>
        
        <span class="k">for</span> <span class="n">_range</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">:</span>
            <span class="n">dt_decision_result</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">dt_score</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dt_curr_decisions</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="n">rf_decision_result</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">rf_score</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">rf_curr_decisions</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="n">tot_games</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="k">for</span> <span class="n">train</span> <span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">_leagues_cross_validation</span><span class="p">():</span>  
                <span class="n">clf_dt</span> <span class="o">=</span> <span class="n">DTC</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">])</span>
                <span class="n">clf_dt</span> <span class="o">=</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">train</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="n">clf_rf</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">])</span>
                <span class="n">clf_rf</span> <span class="o">=</span> <span class="n">clf_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">train</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="n">dt_res_tags</span> <span class="o">=</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dt_res_proba</span> <span class="o">=</span> <span class="n">clf_dt</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="n">rf_res_tags</span> <span class="o">=</span> <span class="n">clf_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rf_res_proba</span> <span class="o">=</span> <span class="n">clf_rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_res_tags</span><span class="p">)):</span>
                    <span class="n">tot_games</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">dt_res_proba</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">_range</span><span class="p">:</span>
                        <span class="n">dt_curr_decisions</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">dt_res_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">dt_score</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rf_res_tags</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">rf_res_proba</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">_range</span><span class="p">:</span>
                        <span class="n">rf_curr_decisions</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">rf_res_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">rf_score</span> <span class="o">+=</span> <span class="mi">1</span> 
                                   
            <span class="n">dt_decision_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt_score</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">dt_curr_decisions</span>
            <span class="n">rf_decision_result</span> <span class="o">=</span> <span class="p">(</span><span class="n">rf_score</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="n">rf_curr_decisions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">][</span><span class="n">_range</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt_curr_decisions</span><span class="p">,</span><span class="n">dt_decision_result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">][</span><span class="n">_range</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rf_curr_decisions</span><span class="p">,</span><span class="n">rf_decision_result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&quot;AG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot_games</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        
        </div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment checks the best probability given by the Decision Tree from which  </span><span class="se">\</span>
<span class="s">we start making the decisions.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - only tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_proba_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">float</span><span class="p">(</span><span class="n">_k</span><span class="p">):(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">][</span><span class="n">_k</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">][</span><span class="n">_k</span><span class="p">])</span> <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;DTC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">_inner_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">key</span><span class="p">,</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],(</span><span class="nb">float</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&quot;AG&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],(</span><span class="nb">float</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&quot;AG&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">tup</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_proba_scores</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>
        <span class="n">_table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">([</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">_inner_table</span><span class="p">],</span>\
                          <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Probability&#39;</span><span class="p">,</span><span class="s">&#39;QG DT&#39;</span><span class="p">,</span><span class="s">&#39;Score DT&#39;</span><span class="p">,</span><span class="s">&#39;AS DT&#39;</span><span class="p">,</span><span class="s">&#39;QG RF&#39;</span><span class="p">,</span><span class="s">&#39;Score RF&#39;</span><span class="p">,</span><span class="s">&#39;AS RF&#39;</span><span class="p">],</span><span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;fancy_grid&quot;</span><span class="p">,</span><span class="n">floatfmt</span><span class="o">=</span><span class="s">&quot;.4f&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;Results :</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="n">_table</span>
  </div>
<div class="viewcode-block" id="FinalSeasonExperiment"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonExperiment">[docs]</a><span class="k">class</span> <span class="nc">FinalSeasonExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An experiment to test the results of the classifier for last season (2015-2016).</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FinalSeasonExperiment.__init__"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonExperiment.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">dir_name</span>
    </div>
<div class="viewcode-block" id="FinalSeasonExperiment.load_params"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonExperiment.load_params">[docs]</a>    <span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The load_params for this experiment loads the best params for the decision tree and random forest and also the best lookback.</span>
<span class="sd">        </span>
<span class="sd">        This params found by the experiment best_param, lookback by best_lookback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_param_exp</span> <span class="o">=</span> <span class="n">BestParamsExperiment</span><span class="p">(</span><span class="s">&quot;Best_Params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">best_param_exp</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="n">best_lookback_exp</span> <span class="o">=</span> <span class="n">BestLookbackExperimet</span><span class="p">(</span><span class="s">&quot;Best_Params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_prev_experiment</span><span class="p">(</span><span class="n">best_lookback_exp</span><span class="p">):</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;DTC&#39;</span><span class="p">:</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Tree&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span><span class="s">&#39;RFC&#39;</span><span class="p">:</span><span class="n">best_param_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Forest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span>\
                                  <span class="s">&#39;Fix&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([(</span><span class="n">best_lookback_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_lk</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">_lk</span><span class="p">)</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="n">best_lookback_exp</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">])[</span><span class="mi">1</span><span class="p">])}</span>
        <span class="k">return</span> <span class="bp">True</span>
    </div>
<div class="viewcode-block" id="FinalSeasonExperiment.get_data"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonExperiment.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads all the examples and tags needed for the experiment - building the examples based on the lookback found in previous experiments.</span>
<span class="sd">        </span>
<span class="sd">        Loads the all of the examples and tags, and also creates cross validation for the classifiers..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidation</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
        <span class="n">lookback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span><span class="p">[</span><span class="s">&#39;Fix&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">lookback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">complete_tags</span>
    </div>
<div class="viewcode-block" id="FinalSeasonExperiment.run"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonExperiment.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs prediction against the current season (2015-2016).</span>
<span class="sd">        </span>
<span class="sd">        Tries both building a classifier from all the leagues and predict, and building a specific classifier for each league and predict only that league.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_params</span><span class="p">():</span>
            <span class="k">print</span> <span class="s">&#39;Can not run- must load previous experiment&#39;</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;Final_Season&quot;</span><span class="p">:</span>
            <span class="n">Experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">clf</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">])</span>
            <span class="n">clf</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidation</span><span class="p">(</span><span class="n">test</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span>
            <span class="n">clf</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">estimators_params</span><span class="p">[</span><span class="s">&#39;RFC&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span> <span class="o">=</span> <span class="p">{}</span>   
        
        <span class="k">for</span> <span class="n">_league</span> <span class="ow">in</span> <span class="n">LEAGUES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">dbh</span><span class="o">.</span><span class="n">league</span> <span class="o">=</span> <span class="n">_league</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;Final_Season_S&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MIN_YEAR</span><span class="p">,</span><span class="n">MAX_YEAR</span><span class="p">):</span>
                    <span class="n">temp_ex</span><span class="p">,</span> <span class="n">temp_ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">dbh</span><span class="o">.</span><span class="n">create_examples</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">lookback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Fix&#39;</span><span class="p">],</span><span class="n">current</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">+=</span> <span class="n">temp_ex</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">temp_ta</span>
                <span class="n">clf</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            
            <span class="n">raw_curr_examples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">curr_tags</span> <span class="o">=</span> <span class="p">[]</span>    
            <span class="n">raw_curr_examples</span><span class="p">,</span> <span class="n">curr_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv</span><span class="o">.</span><span class="n">dbh</span><span class="o">.</span><span class="n">create_examples</span><span class="p">(</span><span class="n">MAX_YEAR</span><span class="p">,</span><span class="n">lookback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="s">&#39;Fix&#39;</span><span class="p">],</span><span class="n">current</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="n">curr_examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">_ex</span><span class="p">[</span><span class="s">&quot;Ex&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_ex</span> <span class="ow">in</span> <span class="n">raw_curr_examples</span><span class="p">]</span>
            <span class="n">result_tags</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">curr_examples</span><span class="p">)</span>
            <span class="n">result_proba</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">curr_examples</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;score&quot;</span><span class="p">:</span><span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">curr_examples</span><span class="p">,</span> <span class="n">curr_tags</span><span class="p">),</span><span class="s">&quot;array&quot;</span><span class="p">:[],</span><span class="s">&quot;dict&quot;</span><span class="p">:{</span><span class="n">i</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">61</span><span class="p">)}}</span>
            <span class="n">amount_games_per_fix</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">61</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_curr_examples</span><span class="p">)):</span>
                <span class="n">_ex</span> <span class="o">=</span> <span class="n">raw_curr_examples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">curr_fix</span> <span class="o">=</span> <span class="n">_ex</span><span class="p">[</span><span class="s">&quot;Fix&quot;</span><span class="p">]</span>
                <span class="n">curr_result</span> <span class="o">=</span> <span class="n">_ex</span><span class="p">[</span><span class="s">&quot;Res&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;array&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">_ex</span><span class="p">[</span><span class="s">&quot;League&quot;</span><span class="p">],</span><span class="n">_ex</span><span class="p">[</span><span class="s">&quot;Home&quot;</span><span class="p">],</span><span class="n">_ex</span><span class="p">[</span><span class="s">&quot;Away&quot;</span><span class="p">],</span><span class="n">curr_result</span><span class="p">,</span><span class="n">result_tags</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">result_proba</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
                <span class="n">amount_games_per_fix</span><span class="p">[</span><span class="n">curr_fix</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">result_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">curr_tags</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">curr_fix</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">_k</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">amount_games_per_fix</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">_league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span> <span class="o">/</span> <span class="n">amount_games_per_fix</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">)</span>
        </div>
    <span class="n">_begining_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;This experiment checks the results of the classifier for last season. one classifier from all the leagues and </span><span class="se">\</span>
<span class="s">one specific classifier for each league.&quot;&quot;&quot;</span>
            
    <span class="n">_ending_report</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Done&quot;&quot;&quot;</span>
    
    <span class="nd">@property</span>        
    <span class="k">def</span> <span class="nf">_no_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reporting on low verbosity - generates prediction in for each league (all games in current season), and prints averaged accuracy for each fixture.</span>
<span class="sd">        </span>
<span class="sd">        For each fixture we get avareged accuracy for all leagues and avarege accuracy per league.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">all_scores_league</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">amount_overlap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">flag_first</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">league</span> <span class="ow">in</span> <span class="n">LEAGUES</span><span class="p">:</span>
            <span class="n">_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">_lk</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">]}</span>
            <span class="n">_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;score&quot;</span><span class="p">]</span>
            <span class="n">all_scores_league</span><span class="p">[</span><span class="n">league</span><span class="p">]</span> <span class="o">=</span> <span class="n">_scores</span>
            <span class="k">if</span> <span class="n">flag_first</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">_scores</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
                <span class="n">flag_first</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">_scores</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">_k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">all_scores</span><span class="p">:</span>
            <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">/</span> <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
        <span class="n">_inner_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">key</span><span class="p">,</span><span class="n">all_scores</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_inner_table</span><span class="p">)):</span>
            <span class="n">_inner_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">all_scores_league</span><span class="p">[</span><span class="n">_l</span><span class="p">]</span> <span class="k">for</span> <span class="n">_l</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">LEAGUES</span><span class="p">)]</span>
        <span class="n">curr_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Fix&#39;</span><span class="p">,</span><span class="s">&#39;Score&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_l</span> <span class="k">for</span> <span class="n">_l</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">LEAGUES</span><span class="p">)]</span>
        <span class="n">_table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">([</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">_inner_table</span><span class="p">],</span>\
                            <span class="n">headers</span><span class="o">=</span><span class="n">curr_headers</span><span class="p">,</span><span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;fancy_grid&quot;</span><span class="p">,</span><span class="n">floatfmt</span><span class="o">=</span><span class="s">&quot;.4f&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Results for experiment </span><span class="si">%s</span><span class="s"> :</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">_table</span><span class="p">)</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Medium verbosity - save external files </span>
<span class="sd">        </span>
<span class="sd">        For each league we save {fix,success_rate} , {team_a,team_b,result,tag,proba(-1),proba(0),proba(1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">amount_overlap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">flag_first</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">league</span> <span class="ow">in</span> <span class="n">LEAGUES</span><span class="p">:</span>
            <span class="n">_scores</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">_lk</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">][</span><span class="n">_lk</span><span class="p">]</span> <span class="k">for</span> <span class="n">_lk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;dict&quot;</span><span class="p">]}</span>
            <span class="n">_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;score&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">flag_first</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">_scores</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
                <span class="n">flag_first</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_k</span> <span class="ow">in</span> <span class="n">_scores</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">_k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">amount_overlap</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">all_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_scores</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
            <span class="n">_inner_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">key</span><span class="p">,</span><span class="n">_scores</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">_scores</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="n">_table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">([</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">_inner_table</span><span class="p">],</span>\
                              <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Fix&#39;</span><span class="p">,</span><span class="s">&#39;Score&#39;</span><span class="p">],</span><span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;fancy_grid&quot;</span><span class="p">,</span><span class="n">floatfmt</span><span class="o">=</span><span class="s">&quot;.4f&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_name</span><span class="p">,</span><span class="n">league</span><span class="o">+</span><span class="s">&quot;_fix_res.txt&quot;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_table</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="n">_inner_table</span> <span class="o">=</span> <span class="p">[[</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;-&quot;</span><span class="o">+</span><span class="n">elem</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">elem</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_data</span><span class="p">[</span><span class="n">league</span><span class="p">][</span><span class="s">&quot;array&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">league</span><span class="p">]</span>
            <span class="n">_table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">([</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">_inner_table</span><span class="p">],</span>\
                          <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Home&#39;</span><span class="p">,</span><span class="s">&#39;Away&#39;</span><span class="p">,</span><span class="s">&#39;Result&#39;</span><span class="p">,</span><span class="s">&#39;Tag&#39;</span><span class="p">,</span><span class="s">&#39;-1&#39;</span><span class="p">,</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">],</span><span class="n">tablefmt</span><span class="o">=</span><span class="s">&quot;fancy_grid&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_name</span><span class="p">,</span><span class="n">league</span><span class="o">+</span><span class="s">&quot;_results.txt&quot;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_table</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="FinalSeasonAux"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonAux">[docs]</a><span class="k">class</span> <span class="nc">FinalSeasonAux</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auxiliary experiment around the Final Season experiment modes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FinalSeasonAux.__init__"><a class="viewcode-back" href="../expr.html#experiments.FinalSeasonAux.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Experiment</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">dir_name</span>
        </div>
    <span class="nd">@timed</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FinalSeasonExperiment</span><span class="p">(</span><span class="s">&quot;Final_Season&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">FinalSeasonExperiment</span><span class="p">(</span><span class="s">&quot;Final_Season_S&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="n">FinalSeasonExperiment</span><span class="p">(</span><span class="s">&quot;Final_Season&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        <span class="n">FinalSeasonExperiment</span><span class="p">(</span><span class="s">&quot;Final_Season_S&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">)</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
        
       
        </div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">ExperimentArgsParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
    <span class="n">_experiments</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Best_Params&#39;</span><span class="p">:</span><span class="n">BestParamsExperiment</span><span class="p">,</span><span class="s">&#39;Best_Lookback&#39;</span><span class="p">:</span><span class="n">BestLookbackExperimet</span><span class="p">,</span>\
                    <span class="s">&#39;Best_Proba&#39;</span><span class="p">:</span><span class="n">BestProbaForDecision</span><span class="p">,</span><span class="s">&#39;Final_Season&#39;</span><span class="p">:</span><span class="n">FinalSeasonAux</span><span class="p">,</span>\
                    <span class="s">&#39;Learning_Curve&#39;</span><span class="p">:</span><span class="n">LearningCurveExperiment</span><span class="p">,</span><span class="s">&#39;Bayes&#39;</span><span class="p">:</span><span class="n">BayesExperiment</span><span class="p">,</span><span class="s">&#39;Default_Params&#39;</span><span class="p">:</span><span class="n">DefaultParamsExperiment</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s">&#39;run&#39;</span><span class="p">:</span>
        <span class="n">_experiments</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">exp</span><span class="p">](</span><span class="n">dir_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_experiments</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">exp</span><span class="p">](</span><span class="n">dir_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">)</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">verbosity</span><span class="p">,</span><span class="n">outfile</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">outfile</span><span class="p">)</span>
       
        
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../before.html">1. Things To Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_classes.html">2. Project Data Handeling Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils_classes.html">3. Project Utils Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../expr.html">4. Project Experiments</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">AI_Project 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Ory Jonay, Dror Porat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>